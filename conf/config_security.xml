<?xml version="1.0" encoding="utf-8"?>
<configdata>
    <env>
        <REQUEST_SECURITY_LEVEL value="1" />
        <RESPONSE_SECURITY_LEVEL value="1" />
    </env>
    <hooks>
        <hook name="on_app_run" obj="\phpformsframework\libs\security\Buckler" method="antiVulnerabilityScanner" />
    </hooks>
    <badpath>
        <rule source="^/cache*"                         destination="404"       />
        <rule source="^/uploads*"                       destination="404"       />
        <rule source="^/vendor*"                        destination="404"       />
        <rule source="*/index*"                         destination="$1"        />
        <rule source="wp-login*"                        destination="401"       />
        <rule source="wp-*"                             destination="403"       />
        <rule source="*.shtml"                          destination="403"       />
        <rule source="[^a-z\-0-9/\+\.\_\\@]+"           destination="400"       />

        <rule source="^/autodiscover/*"                 destination="404"       />
    </badpath>
    <pages>
        <!-- Widgets -->
        <page path="/login" engine="auth-login">
            <header name="csrf"                                                 />
            <header name="refresh"                                              />
            <header name="domain"                                               />

            <get name="domain"                                                  />

            <post name="domain"                                                 />
            <post name="username"   required="true"     validator="username"    />
            <post name="password"   required="true"     validator="password"    />
            <post name="permanent"                      validator="bool"        />
        </page>
        <page path="/logout" engine="auth-logout">
            <header name="csrf"                 />
        </page>
        <page path="/activation" engine="auth-activation">
            <header name="csrf"                 />

            <get name="identity"        validator="email"  />
            <get name="error"                   />

            <post name="code"            validator="totp"/>
            <post name="identity"        validator="email" />
            <post name="answer"                 />
        </page>

        <page path="/recover" engine="auth-recover">
            <header name="csrf"                 />
            <post name="code"            validator="totp" />
            <post name="identity"        validator="email" />
            <post name="value"           validator="password" />
            <post name="answer"                 />
        </page>
        <page path="/registration" engine="auth-registration">
            <header name="csrf"                 />

            <get name="domain"                  />

            <post name="username"            required="true" validator="username" />
            <post name="password"            required="true" validator="password" />
            <post name="email"               validator="email" />
            <post name="tel"                 validator="tel" />
            <post name="avatar"                 />
        </page>
    </pages>

    <engine>
        <auth-login             obj="phpformsframework\libs\security\widgets\Login"             method="page"       log="notice.auth"           />
        <auth-logout            obj="phpformsframework\libs\security\widgets\Logout"            method="page"       log="notice.auth"           />
        <auth-activation        obj="phpformsframework\libs\security\widgets\Activation"        method="page"       log="notice.auth"           />
        <auth-recover           obj="phpformsframework\libs\security\widgets\Recover"           method="page"       log="notice.auth"           />
        <auth-registration      obj="phpformsframework\libs\security\widgets\Registration"      method="page"       log="notice.auth"           />
    </engine>

    <models>
        <model name="user" collection="access" table="users" mapclass="\phpformsframework\libs\security\UserData">
            <field name="uuid"              db="users.uuid"                         source="$uuid"                  fake="fdbba8ff-86a4-442f-a3c4-ac034210b7e9" />
            <field name="username"          db="users.username"                     source="$username"              fake="nobody" />
            <field name="email"             db="users.email"                        source="$email"                 fake="john.doe@nobody.it" />
            <field name="tel"               db="users.tel"                          source="$tel"                   fake="3498844546" />
            <field name="display_name"      db="users.username"                     source="$username"              fake="nobody" />
            <field name="avatar"            db="users.avatar"                       source="$avatar"                fake="noavatar" />
            <field name="status"            db="users.status"                       source="$status"                fake="1" />
            <field name="acl"               db="users.acl"                          source="$acl"                   fake="" />
        </model>
    </models>
</configdata>